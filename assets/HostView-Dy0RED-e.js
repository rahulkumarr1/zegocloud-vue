import{_ as d,Z as u,a as h,c as l,b as i,F as g,r as p,w as v,v as f,o as c,t as m}from"./index-DpRcTCvR.js";const S={components:{},data(){return{appID:142874099,server:"wss://webliveroom142874099-api.coolzcloud.com/ws",user_id:"USER_001",userName:"USER_001",token:"",room_id:"0007",streamID:"0007",isChecked:!1,isLogin:!1,publishVideo:!1,localStream:null,remoteStream:null,published:!1,played:!1,mesaageList:[],userMsg:null,microphoneDevicesVal:null,cameraDevicesVal:"",cameraCheckStatus:!0,microphoneCheckStatus:!0,publishStreamStatus:!1,connectStatus:"DISCONNECTED",audioDeviceList:[],videoDeviceList:[],streamFirstID:"0007",streamSecondID:"0008",mixed:!1,mixStreamID:"mix_"+Date.now(),taskID:"00070008",videoCodec:localStorage.getItem("VideoCodec")==="H.264"?"H264":"VP8",zg:null}},methods:{createZegoExpressEngine(){this.zg=new u.ZegoExpressEngine(this.appID,this.server),this.genrateToken()},genrateToken(){h.get("https://dhwaniastro.democlicks.com/api/zego_access_token",{params:{roomId:this.room_id,userID:this.user_id}}).then(s=>{console.log(s),s.data.status==!0?this.token=s.data._token:console.log("token not genrate")})},async enumDevices(){const s=await this.zg.enumDevices();this.audioDeviceList=s&&s.microphones.map((e,t)=>(e.deviceName||(e.deviceName="microphone"+t),console.log("microphone: "+e.deviceName),e)),this.audioDeviceList.push({deviceID:0,deviceName:"禁止"}),this.microphoneDevicesVal=this.audioDeviceList[0].deviceID,this.videoDeviceList=s&&s.cameras.map((e,t)=>(e.deviceName||(e.deviceName="camera"+t),console.log("camera: "+e.deviceName),e)),this.videoDeviceList.push({deviceID:0,deviceName:"禁止"}),this.cameraDevicesVal=this.videoDeviceList[0].deviceID},async checkSystemRequirements(){console.log("sdk version is",this.zg.getVersion());try{const s=await this.zg.checkSystemRequirements();if(console.warn("checkSystemRequirements ",s),s.webRTC){if(!s.videoCodec.H264&&!s.videoCodec.VP8)return console.error("browser is not support H264 and VP8"),!1;if(!s.camera&&!s.microphone)return console.error("camera and microphones not allowed to use"),!1;s.videoCodec.VP8?s.screenSharing||console.warn("browser is not support screenSharing"):console.log("不支持VP8，请前往混流转码测试")}else return console.error("browser is not support webrtc!!"),!1;return!0}catch(s){return console.error("checkSystemRequirements",s),!1}},initEvent(){this.zg.on("roomStateUpdate",(s,e,t,a)=>{}),this.zg.on("roomUserUpdate",(s,e,t)=>{console.warn(`roomUserUpdate: room ${s}, user ${e==="ADD"?"added":"left"} `,JSON.stringify(t))}),this.zg.on("roomStreamUpdate",async(s,e,t,a)=>{e=="ADD"?(this.streamID=t[0].streamID,this.startPlaying()):e=="DELETE"&&this.stopPlaying(),console.log("roomStreamUpdate roomID ",s,t)}),this.zg.on("IMRecvBroadcastMessage",(s,e)=>{for(let t=0;t<e.length;t++)console.log({username:e[t].fromUser.userName,message:e[t].message}),this.mesaageList.push({username:e[t].fromUser.userName,message:e[t].message})})},loginRoom(){if(!this.isLogin)try{return this.isLogin=!0,this.zg.loginRoom(this.room_id,this.token,{userID:this.user_id,userName:this.userName})}catch(s){throw s}},startPlaying(){const s={camera:{video:this.cameraCheckStatus?{input:this.cameraDevicesVal}:!1,audio:this.microphoneCheckStatus?{input:this.microphoneDevicesVal}:!1}};this.startPlayingStream(this.streamID,s),this.publishVideo=!0},stopPlaying(){this.stopPlayingStream(this.streamID)},logoutRoom(){this.zg.logoutRoom(this.room_id)},sendUserMessage(){const s=this.userMsg;this.sendBroadcastMessage(this.room_id,s),this.mesaageList.push({username:this.userName,message:s}),this.userMsg=null},async startPlayingStream(s,e={}){try{return this.localStream=await this.zg.createZegoStream(e),console.log(e),this.zg.startPublishingStream(s,this.localStream),this.localStream.playVideo(document.querySelector("#local-video")),this.isload=!0,!0}catch{return!1}},async stopPlayingStream(s){this.zg.stopPublishingStream(s),this.zg.destroyStream(this.localStream)},async sendBroadcastMessage(s,e){try{return await this.zg.sendBroadcastMessage(s,e)}catch(t){return{errorCode:1,extendedData:JSON.stringify(t)}}},async startMixerTask(s,e,t){try{const a=await this.zg.startMixerTask({taskID:s,inputList:e,outputList:[t],outputConfig:{outputBitrate:300,outputFPS:15,outputWidth:320,outputHeight:480}});return this.mixerOutputList=JSON.parse(a.extendedData).mixerOutputList,a.errorCode}catch{return 1}},async stopMixerTask(s){await this.zg.stopMixerTask(s)},async startMixTask(){const s=this.FirstStreamID,e=this.SecondStreamID,t=this.mixStreamID,a=this.mixed,n=[{streamID:s,layout:{top:0,left:0,bottom:240,right:320}},{streamID:e,layout:{top:240,left:0,bottom:480,right:320}}];a||(await startMixerTask(t,n,t)===0?a=!0:(this.stopMixerTask(t),a=!1))},async StartPlayingMixedStream(){if(this.played)this.played=!1;else{const s=await this.zg.startPlayingStream(streamID);this.zg.createRemoteStreamView(s).play("playVideo"),this.played=!0}}},watch:{token(){this.loginRoom()},isLogin(){this.isLogin==!0&&this.startPlaying()}},mounted(){this.createZegoExpressEngine(),this.checkSystemRequirements(),this.initEvent()}},D={class:"container"},y={class:"row"},k={class:"col-sm-6"},x=i("div",null,[i("div",{id:"local-video"})],-1),w=i("div",null,[i("div",{id:"playVideo"})],-1),I={class:"col-sm-6"},b=i("h3",null,"Message",-1),M={class:"list-group"},_={class:"list-group-item"},C={class:"input-group mb-3"},L=i("span",{class:"input-group-text btn btn-info"},"Send",-1),V=[L];function P(s,e,t,a,n,r){return c(),l("div",D,[i("div",y,[i("div",k,[x,w,i("div",null,[i("a",{href:"#",onClick:e[0]||(e[0]=o=>r.loginRoom()),class:"btn btn-success"},"Login Room"),i("a",{href:"#",onClick:e[1]||(e[1]=o=>r.logoutRoom()),class:"btn btn-danger"},"Logout Room"),i("a",{href:"#",onClick:e[2]||(e[2]=o=>r.startPlaying()),class:"btn btn-info"},"Start"),i("a",{href:"#",onClick:e[3]||(e[3]=o=>r.stopPlaying()),class:"btn btn-warning"},"Stop"),i("a",{href:"#",onClick:e[4]||(e[4]=o=>r.startMixTask()),class:"btn btn-warning"},"startMixTask"),i("a",{href:"#",onClick:e[5]||(e[5]=o=>r.startMixTask()),class:"btn btn-warning"},"stopMixTask"),i("a",{href:"#",onClick:e[6]||(e[6]=o=>r.StartPlayingMixedStream()),class:"btn btn-warning"},"StartPlayingMixedStream")])]),i("div",I,[b,i("ul",M,[(c(!0),l(g,null,p(n.mesaageList,o=>(c(),l("li",_,m(o.username)+" : "+m(o.message),1))),256))]),i("div",C,[v(i("input",{type:"text",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=o=>n.userMsg=o),placeholder:"Your Message"},null,512),[[f,n.userMsg]]),i("div",{class:"input-group-append",onClick:e[8]||(e[8]=o=>r.sendUserMessage())},V)])])])])}const N=d(S,[["render",P]]);export{N as default};
